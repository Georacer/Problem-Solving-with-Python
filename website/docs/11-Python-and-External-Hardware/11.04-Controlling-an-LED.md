
## Controlling an LED with Python
In this section you will learn how to control an LED connected to an external piece of hardware (an Arduino) using Python. To accomplish this task the following hardware is required:

 * A computer running Python
 * An Arduino
 * An LED
 * Wires, a resistor and a breadboard to connect the LED to the Arduino
 * A USB cable to connect the Arduino to the computer
### Set up the LED
Connect the LED to the Arduino using a resistor, wires and a breadboard. Note the short leg of the resistor is connected to ground and the long leg of the resistor is through a resistor to PIN 13. A resistor is needed to prevent too much current from flowing through the LED. This type of resistor is called a _pull up resistor_.
![Arduino with LED](images/arduino_LED.png)
### Upload code to the Arduino
Upload the following code to the Arduino using the Arduino IDE. This is the example sketch called ```Physical Pixel```. The ```Physical Pixel``` sketch can be found in the Arduino IDE by going to File --> Examples --> 04.Communication --> PhysicalPixel

![Physical Pixel Example Sketch in the Arduino IDE](images/file-examples-communication-physicalpixel.png)

The code for the Physical Pixel Sketch is shown below. Note that Arduinos don't use the Python programming language.
```text
//  Found in the Arduino IDE: File --> Examples --> 04.Communication --> PhysicalPixel

const int ledPin = 13; // the pin that the LED is attached to
int incomingByte;      // a variable to read incoming serial data into

void setup() {
  // initialize serial communication:
  Serial.begin(9600);
  // initialize the LED pin as an output:
  pinMode(ledPin, OUTPUT);
}

void loop() {
  // see if there's incoming serial data:
  if (Serial.available() > 0) {
    // read the oldest byte in the serial buffer:
    incomingByte = Serial.read();
    // if it's a capital H (ASCII 72), turn on the LED:
    if (incomingByte == 'H') {
      digitalWrite(ledPin, HIGH);
    }
    // if it's an L (ASCII 76) turn off the LED:
    if (incomingByte == 'L') {
      digitalWrite(ledPin, LOW);
    }
  }
}
```
### Connect the Arduino to the Computer
Connect the Arduino to the computer using a USB cable. Make sure the ```Port``` is selected properly in the Arduino IDE under Tools --> Port. 

In the Arduino IDE, click the [checkmark] to verify and the [arrow] to upload. If the sketch does not upload, check which COM port is selected in Tools --> Port.

![Arduino IDE Check to Verify](images/Check_to_Verify.png)

![Arduino IDE Arrow to Upload](images/Arrow_to_Upload.png)
### Turn the LED on and off with the Arduino Serial Monitor
Bring up the Arduino Serial Monitor and type ```L``` or ```H``` and click [Send] and observe the LED turn on and off.

![Arduino Serial Monitor](images/serial_monitor_L.png)
### Write a Pyton Script to turn the LED on and off
After the LED turns on and off based on input at the Arduino Serial Monitor, it is time to write a Python script to turn the LED on and off. This can be accomplished using the **PySerial** package. Make sure **PySerial** is installed before script is run. 

At the top of the script, import the **PySerial** module. Note that even though the package is called **PySerial** the line ```import serial``` is used. The **time** module is also imported as the ```time.sleep()``` function will be used in the script.
```python
import serial
import time
```
In the next part of the Python script, create a loop that will blink the LED on and off for about 5 seconds. Note the byte string ```b'H'``` need to be sent to the Arduino, not the unicode string ```'H'```. The unicode string ```'H'``` is pre-pended with the letter ```b``` in ```ser.writelines(b'H')```.
```python
data = []
for i in range(10):
    with serial.Serial('COM4', 9800, timeout=1) as ser:
        ser.writelines(b'H')   # send a byte
        time.sleep(0.5)        # wait 0.5 seconds before reading the next line
        ser.writelines(b'L')   # send a byte
```     
### Write a Python script to allow a user to turn the LED on and off
Once the LED blinks on and off successfully using a Python script, it is time to write a new Python script that will allow a user to turn the LED on and off. At the top of the new Python script import the **PySerial** and **time** modules.
```python
import serial
import time
```
Next, give the user instructions. If the user types ```H```, the LED will turn on. If the user types ```L``` the LED will turn off. If the user types ```q```, the program will quit.
```python
print('This is a program that allows a user to turn an LED on and off')
print('type H to turn the LED on')
print('type L to turn the LED off')
print('type q to quit')
```
Finally, the script needs a while loop to ask the user for an ```H``` or ```L``` character. Once the user enters the letter, the  letter needs to be converted to a byte string. Then the byte string is sent over the serial line to the Arduino. A delay is added so that the Arduino can process the previous command before dealing with the next one. 
```python
user_input = input('H = on, L = off, q = quit' : )
while user_input != 'q':
    with serial.Serial('COM4', 9800, timeout=1) as ser:
        byte_command = encode(user_input)
        ser.writelines(byte_command)   # send a byte
        time.sleep(0.1) # wait 0.5 seconds before reading the next line
        user_input = input('H = on, L = off, q = quit' : )
print('q entered. Exiting the program')
```    
        
When the script is running, type ```H``` and ```L``` and observe the LED blink on and off.
 

